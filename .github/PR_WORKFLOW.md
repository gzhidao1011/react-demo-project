# PR 工作流程指南（个人账户私有仓库）

本文档说明在个人账户私有仓库中的 PR 工作流程，由于 GitHub 限制，分支保护规则无法生效，需要通过手动检查确保代码质量。

## ⚠️ 重要说明

**个人账户的私有仓库无法使用 GitHub 分支保护规则**，因此需要**手动检查**以下项目，确保代码质量。

## 📋 PR 合并检查清单

在合并 PR 之前，请确保完成以下检查：

### ✅ 1. CI/CD 检查通过

**检查位置**：PR 页面底部的 **Checks** 部分

**必须满足**：
- [ ] `Test / test` 工作流显示 ✅（绿色）
- [ ] 所有步骤都成功：
  - [ ] 类型检查通过
  - [ ] 代码检查（lint、format）通过
  - [ ] 测试通过
  - [ ] 覆盖率报告生成成功

**如果失败**：
- 查看工作流日志，找到失败原因
- 修复问题后推送新提交
- 等待 CI 重新运行并通过

### ✅ 2. 代码审查

**检查位置**：PR 页面的 **Reviewers** 部分

**必须满足**：
- [ ] CODEOWNERS 指定的审查者已审批（显示 ✅）
- [ ] 至少 1 个审查者审批（如果配置了 CODEOWNERS）
- [ ] 所有审查评论已解决

**如果未审批**：
- 等待审查者审批
- 根据审查反馈修改代码
- 解决所有评论

### ✅ 3. PR 描述完整

**检查位置**：PR 页面顶部的描述部分

**必须满足**：
- [ ] PR 描述清晰说明变更目的
- [ ] 已勾选变更类型
- [ ] 已说明影响范围
- [ ] 已提供测试步骤（如适用）

### ✅ 4. 代码质量

**检查位置**：PR 页面的 **Files changed** 标签

**必须满足**：
- [ ] 代码遵循项目代码风格
- [ ] 没有引入调试代码（console.log 等）
- [ ] 没有引入敏感信息（API 密钥、密码等）
- [ ] 已添加必要的注释和文档

### ✅ 5. 测试覆盖

**检查位置**：PR 页面的 Codecov 评论或 Artifacts

**建议满足**：
- [ ] 新功能已添加测试用例
- [ ] 测试覆盖率未显著下降
- [ ] 覆盖率报告已生成

### ✅ 6. 分支同步

**检查位置**：PR 页面顶部的分支状态

**必须满足**：
- [ ] 分支与主分支同步（显示 "This branch is up to date"）
- [ ] 或已解决合并冲突

**如果不同步**：
```bash
# 方法 1：Rebase（推荐）
git checkout your-branch
git rebase main
git push --force-with-lease

# 方法 2：Merge
git checkout your-branch
git merge main
git push
```

## 🔄 标准 PR 流程

### 1. 创建 PR

1. 创建功能分支
2. 进行代码变更
3. 提交并推送代码
4. 在 GitHub 上创建 PR
5. 填写 PR 描述（使用模板）

### 2. 等待 CI 检查

1. CI 自动运行测试和检查
2. 查看 **Checks** 部分确认通过
3. 如果失败，修复问题后推送新提交

### 3. 代码审查

1. CODEOWNERS 自动分配审查者
2. 审查者审查代码并提出反馈
3. 根据反馈修改代码
4. 解决所有评论

### 4. 最终检查

在合并前，PR 作者或审查者应确认：

- [ ] ✅ 所有 CI 检查通过
- [ ] ✅ 获得审查者审批
- [ ] ✅ 所有评论已解决
- [ ] ✅ 分支与主分支同步
- [ ] ✅ PR 描述完整

### 5. 合并 PR

确认所有检查通过后，可以合并 PR：

- **Squash and merge**（推荐）：将 PR 的所有提交合并为一个提交
- **Merge commit**：保留所有提交历史
- **Rebase and merge**：将 PR 的提交 rebase 到主分支

## 🚫 禁止的操作

以下操作**禁止**在未完成检查的情况下执行：

- ❌ **禁止**在 CI 检查失败时合并 PR
- ❌ **禁止**在未获得审查者审批时合并 PR
- ❌ **禁止**在未解决评论时合并 PR
- ❌ **禁止**直接推送到主分支（必须通过 PR）
- ❌ **禁止**绕过检查强制合并

## 📝 团队约定

### PR 作者职责

- ✅ 确保代码质量
- ✅ 通过所有 CI 检查
- ✅ 响应审查反馈
- ✅ 解决所有评论
- ✅ 保持分支同步

### 审查者职责

- ✅ 及时审查 PR
- ✅ 提供建设性反馈
- ✅ 关注代码质量和可维护性
- ✅ 确保测试覆盖新功能
- ✅ 在满足条件时及时审批

### 维护者职责

- ✅ 监督 PR 流程
- ✅ 确保团队遵守约定
- ✅ 处理紧急情况（如需要）
- ✅ 定期审查代码质量

## 🔧 工具和资源

### CI/CD 检查

- **工作流文件**：`.github/workflows/test.yml`
- **检查内容**：类型检查、代码检查、测试、覆盖率

### 代码审查

- **CODEOWNERS**：`.github/CODEOWNERS`
- **PR 模板**：`.github/PULL_REQUEST_TEMPLATE.md`

### 覆盖率报告

- **Codecov**：PR 中的覆盖率评论
- **Artifacts**：GitHub Actions 中的覆盖率报告下载

## 📚 相关文档

- [PR 集成功能说明](./PR_INTEGRATION.md)
- [分支保护规则配置指南](./BRANCH_PROTECTION.md)（仅适用于公开仓库或 Team/Enterprise）
- [Codecov 配置指南](./CODECOV_SETUP.md)

## 💡 提示

虽然个人账户私有仓库无法使用分支保护规则，但通过：

1. ✅ **严格的 CI/CD 检查**（已配置）
2. ✅ **CODEOWNERS 自动分配审查者**（已配置）
3. ✅ **PR 模板规范**（已配置）
4. ✅ **团队协作约定**（本文档）

仍然可以确保代码质量和项目稳定性。

关键是**团队成员的自觉遵守**和**审查者的严格把关**。
