# 如何添加协作者并设置 PR 权限

本文档说明如何为 GitHub 账号添加协作者权限，使其能够创建 PR、审查代码等。

## ⚠️ 重要说明：开源项目 vs 私有仓库

### 开源项目（Public Repository）

**特点**：
- ✅ 任何人都可以查看代码
- ✅ 任何人都可以 Fork 仓库
- ✅ 任何人都可以创建 PR（无需添加为协作者）
- ✅ 任何人都可以查看和评论 PR

**协作者功能的作用**：
- ✅ 授予**直接推送代码**的权限（无需 PR）
- ✅ 授予**合并 PR** 的权限
- ✅ 授予**管理仓库设置**的权限
- ✅ 授予**管理 Issue/PR** 的权限

**总结**：开源项目中，**任何人都可以创建 PR**，但只有协作者才能直接推送代码和合并 PR。

### 私有仓库（Private Repository）

**特点**：
- ❌ 只有协作者可以查看代码
- ❌ 只有协作者可以 Fork 仓库
- ❌ 只有协作者可以创建 PR
- ❌ 只有协作者可以查看和评论 PR

**协作者功能的作用**：
- ✅ **必须**添加为协作者才能访问仓库
- ✅ 授予查看、推送、合并等权限
- ✅ 控制谁可以访问私有代码

**总结**：私有仓库中，**必须添加为协作者**才能进行任何操作。

---

## 📋 添加协作者的步骤

### 方法 1：通过仓库设置添加（推荐）

#### 步骤 1：进入仓库设置

1. 打开 GitHub 仓库页面
2. 点击顶部的 **Settings**（设置）标签
3. 在左侧菜单中找到 **Collaborators**（协作者）

#### 步骤 2：添加协作者

1. 点击 **Add people**（添加人员）按钮
2. 在搜索框中输入用户名：`dujiaoai`
3. 从搜索结果中选择正确的用户
4. **重要**：在添加对话框中，会显示权限选择：
   - 如果看到权限下拉菜单，选择 **Write**（或所需权限）
   - 如果没有看到权限选择，GitHub 可能默认使用 **Read** 权限
5. 点击 **Add [username] to this repository**（将用户添加到此仓库）

**注意**：
- 个人账户的私有仓库：添加协作者时可能不显示权限选择，默认是 **Read** 权限
- 组织账户的仓库：通常会显示权限选择菜单
- 如果添加后权限不正确，需要移除后重新添加

#### 步骤 3：等待用户接受邀请

- GitHub 会向 `dujiaoai` 发送邀请邮件
- 用户需要在邮件中点击接受邀请
- 或者用户可以在 GitHub 通知中接受邀请

### 方法 2：通过邀请链接添加

1. 进入 **Settings** → **Collaborators**
2. 点击 **Add people**
3. 复制邀请链接
4. 将链接发送给 `dujiaoai`，让其访问并接受邀请

## 🔐 权限级别说明

GitHub 提供以下权限级别：

### 1. Read（读取）

**权限**：
- ✅ 查看仓库代码
- ✅ 克隆仓库
- ✅ 创建 Issue
- ✅ 创建 PR（但需要仓库所有者审批）

**限制**：
- ❌ 不能直接推送代码
- ❌ 不能合并 PR
- ❌ 不能修改仓库设置

**适用场景**：
- 只需要查看代码和创建 PR
- 外部贡献者

### 2. Triage（分类）

**权限**：
- ✅ Read 的所有权限
- ✅ 管理 Issue 和 PR（标记、分配、关闭等）
- ✅ 编辑 Issue 和 PR 的标签

**限制**：
- ❌ 不能推送代码
- ❌ 不能合并 PR
- ❌ 不能修改仓库设置

**适用场景**：
- 需要管理 Issue 和 PR
- 项目维护助手

### 3. Write（写入）

**权限**：
- ✅ Triage 的所有权限
- ✅ 推送代码到非保护分支
- ✅ 创建和删除分支
- ✅ 合并 PR（如果分支未受保护）

**限制**：
- ❌ 不能合并到受保护的分支（如 main）
- ❌ 不能修改仓库设置
- ❌ 不能删除仓库

**适用场景**：
- 团队成员
- 需要推送代码和合并 PR

### 4. Maintain（维护）

**权限**：
- ✅ Write 的所有权限
- ✅ 管理仓库设置（部分）
- ✅ 管理 Actions、Packages 等

**限制**：
- ❌ 不能删除仓库
- ❌ 不能转移仓库所有权
- ❌ 不能管理协作者

**适用场景**：
- 项目维护者
- 需要管理仓库设置

### 5. Admin（管理员）

**权限**：
- ✅ 所有权限
- ✅ 管理协作者
- ✅ 修改仓库设置
- ✅ 删除仓库（需要所有者确认）

**限制**：
- ❌ 不能转移仓库所有权
- ❌ 不能删除组织（如果是组织仓库）

**适用场景**：
- 仓库所有者
- 需要完全控制权限

## 🎯 如何给协作者合并 PR 权限

### 方法 1：设置权限级别（必需）

要允许协作者合并 PR，需要授予至少 **Write** 权限：

#### 步骤 1：添加协作者时选择权限

1. 进入 **Settings** → **Collaborators**
2. 点击 **Add people**
3. 输入用户名（如 `dujiaoai`）
4. **选择权限级别**：
   - ✅ **Write**：可以合并 PR（推荐）
   - ✅ **Maintain**：可以合并 PR + 管理仓库
   - ✅ **Admin**：完全控制权限

#### 步骤 2：或修改现有协作者权限

**方法 A：在添加时选择权限（推荐）**

1. 进入 **Settings** → **Collaborators**
2. 点击 **Add people** 按钮
3. 输入用户名并选择用户
4. **在添加时选择权限级别**（Write、Maintain、Admin 等）
5. 点击 **Add [username] to this repository**

**方法 B：修改已添加的协作者权限**

如果协作者已经添加，但权限级别不正确：

1. 进入 **Settings** → **Collaborators**
2. 找到协作者（在协作者列表中）
3. **查看当前权限**（显示在用户名旁边）
4. **移除协作者**：
   - 点击协作者右侧的 **X** 或 **Remove** 按钮
   - 确认移除
5. **重新添加并选择正确权限**：
   - 点击 **Add people**
   - 输入用户名
   - **选择正确的权限级别**（Write 或更高）
   - 添加

**注意**：GitHub 界面可能因仓库类型（个人/组织）和账户类型而有所不同。如果看不到权限下拉菜单，可能需要先移除后重新添加。

### 方法 2：检查分支保护规则（重要）

即使有 Write 权限，如果主分支有保护规则，仍然需要满足条件：

#### 如果主分支有保护规则

协作者需要满足以下条件才能合并：

1. ✅ **通过所有 CI 检查**
   - 类型检查通过
   - 代码检查通过
   - 测试通过

2. ✅ **获得审查者审批**
   - 至少 1 个审查者审批
   - CODEOWNERS 指定的审查者必须审批（如果配置了）

3. ✅ **解决所有评论**
   - 所有 PR 评论必须解决

4. ✅ **分支同步**
   - 分支必须与主分支同步

#### 如果主分支没有保护规则

- ✅ Write 权限可以直接合并 PR
- ✅ 无需审批
- ✅ 无需通过 CI 检查（但仍建议通过）

### 方法 3：配置 CODEOWNERS（可选）

如果希望协作者自动分配为审查者，更新 `.github/CODEOWNERS`：

```codeowners
# 添加协作者为审查者
* @gzhidao1011 @dujiaoai

# 或特定路径
apps/web/ @gzhidao1011 @dujiaoai
packages/utils/ @gzhidao1011 @dujiaoai
```

**注意**：CODEOWNERS 主要用于分配审查者，不影响合并权限。

## 🎯 推荐权限配置

### 对于 `dujiaoai` 账号

根据使用场景选择：

#### 场景 1：只需要创建 PR 和审查代码

**推荐权限**：**Read** 或 **Triage**

- ✅ 可以查看代码
- ✅ 可以创建 PR
- ✅ 可以审查 PR（如果配置了 CODEOWNERS）
- ✅ 可以评论和讨论
- ❌ **不能合并 PR**

#### 场景 2：需要推送代码和合并 PR ⭐

**推荐权限**：**Write**

- ✅ 可以推送代码
- ✅ 可以创建和合并 PR
- ✅ 可以管理分支
- ✅ **可以合并 PR**（如果满足分支保护规则）

**注意**：如果主分支（main）有保护规则，仍然需要审批才能合并。

#### 场景 3：需要管理仓库

**推荐权限**：**Maintain** 或 **Admin**

- ✅ 可以管理仓库设置
- ✅ 可以管理协作者
- ✅ 可以合并 PR
- ✅ 完全控制权限

## 📝 具体操作步骤（为 dujiaoai 添加权限）

### 步骤 1：进入协作者设置

1. 打开仓库：`https://github.com/gzhidao1011/react-demo-project`
2. 点击 **Settings**
3. 点击左侧菜单的 **Collaborators**

### 步骤 2：添加用户

1. 点击 **Add people** 按钮
2. 在搜索框输入：`dujiaoai`
3. 选择用户：`dujiaoai`

### 步骤 3：选择权限

根据需求选择权限级别：

- **Read**：只能查看和创建 PR
- **Write**：可以推送代码和合并 PR（推荐）
- **Maintain**：可以管理仓库设置
- **Admin**：完全控制权限

### 步骤 4：发送邀请

1. 选择权限后，点击 **Add [username] to this repository**
2. GitHub 会发送邀请邮件给 `dujiaoai`
3. 等待用户接受邀请

### 步骤 5：确认添加成功

1. 在 **Collaborators** 页面查看用户列表
2. 确认 `dujiaoai` 已添加
3. 确认权限级别正确

## 🔍 验证权限

添加成功后，`dujiaoai` 可以：

### Read 权限
- ✅ 克隆仓库
- ✅ 创建 PR
- ✅ 查看代码
- ✅ 评论 PR

### Write 权限
- ✅ Read 的所有权限
- ✅ 推送代码到非保护分支
- ✅ 合并 PR（如果分支未受保护）
- ✅ 创建和删除分支

### 查看当前权限

用户可以在仓库页面查看自己的权限：
1. 打开仓库页面
2. 点击右上角的 **Settings**（个人设置）
3. 查看 **Access** 部分

## 🔧 CODEOWNERS 配置

如果 `dujiaoai` 需要自动分配为审查者，需要更新 CODEOWNERS 文件：

### 更新 CODEOWNERS

编辑 `.github/CODEOWNERS` 文件，添加 `@dujiaoai`：

```codeowners
# 全局默认审查者
* @gzhidao1011 @dujiaoai

# 特定路径的审查者
apps/web/ @gzhidao1011 @dujiaoai
packages/utils/ @gzhidao1011 @dujiaoai
```

### 多个审查者

可以为一个路径指定多个审查者：

```codeowners
# 需要所有审查者审批
apps/web/ @gzhidao1011 @dujiaoai

# 或只需要其中一个审批
apps/web/ @gzhidao1011
apps/web/ @dujiaoai
```

## 🚫 权限限制说明

### 个人账户私有仓库的限制

如果仓库是**个人账户的私有仓库**：

- ✅ 可以添加协作者
- ✅ 可以设置权限级别
- ❌ **分支保护规则不生效**（GitHub 限制）
- ✅ CODEOWNERS 仍然有效
- ✅ CI/CD 检查仍然有效

### 受保护分支的限制

如果主分支（main）有保护规则：

- ✅ 所有用户都需要通过 CI 检查
- ✅ 所有用户都需要审查者审批
- ✅ CODEOWNERS 指定的审查者必须审批
- ❌ 即使是 Write 权限，也不能直接合并到受保护分支

## 📚 相关文档

- [CODEOWNERS 配置](./CODEOWNERS)
- [分支保护规则配置指南](./BRANCH_PROTECTION.md)
- [PR 工作流程指南](./PR_WORKFLOW.md)

## ❓ 常见问题

### Q: 如何查看用户的当前权限？

**A**: 
1. 进入 **Settings** → **Collaborators**
2. 在用户列表中查看权限级别

### Q: 如何修改用户的权限？

**A**: 
1. 进入 **Settings** → **Collaborators**
2. 找到用户，点击权限下拉菜单
3. 选择新的权限级别

### Q: 如何移除协作者？

**A**: 
1. 进入 **Settings** → **Collaborators**
2. 找到用户，点击 **Remove** 或 **X**
3. 确认移除

### Q: 用户没有收到邀请邮件？

**A**: 
1. 检查用户的 GitHub 邮箱设置
2. 检查垃圾邮件文件夹
3. 可以在 GitHub 通知中查看邀请

### Q: CODEOWNERS 不生效？

**A**: 
1. 确认用户已添加为协作者
2. 确认 CODEOWNERS 文件路径正确
3. 确认用户名拼写正确（区分大小写）
4. 确认文件路径规则匹配 PR 中的文件

### Q: 用户无法合并 PR？

**A**: 
1. 检查用户权限级别（至少需要 Write）
2. 检查分支是否有保护规则
3. 检查是否满足合并条件（CI 检查、审批等）

## 💡 最佳实践

### 权限管理

1. ✅ **最小权限原则**：只授予必要的权限
2. ✅ **定期审查**：定期检查协作者列表和权限
3. ✅ **使用 CODEOWNERS**：自动分配审查者
4. ✅ **文档记录**：记录权限分配的原因

### 团队协作

1. ✅ **明确角色**：明确每个成员的职责和权限
2. ✅ **统一流程**：使用 PR 流程进行代码审查
3. ✅ **及时响应**：及时处理 PR 和审查请求
